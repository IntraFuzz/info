# 1115
```
/home/lush/test/honggfuzz_spawn_flock/hfuzz_cc/hfuzz-clang nullptr.c -fpic -pie -rdynamic -ldl -lunwind -lunwind-x86_64 -lunwind-generic -lcapstone -o null
/home/lush/test/honggfuzz_spawn_flock/honggfuzz -P -i in -o out -n 1 -- ./null ___FILE___
```
# 0926
```
 ./../honggfuzz -P -i in -o out1 -run_time 60  -- ./kmeans 1000000 ___FILE___
```
# 0918
```
$ occlum run /bin/honggfuzz -P -i in -o out -n 1 -t 5 -- ./kmeans 1000000 ___FILE___
Start time:'2024-09-18.16.46.40' bin:'./kmeans', input:'in', output:'out', persistent:true, stdin:false, mutation_rate:5, timeout:5, max_runs:0, threads:1, minimize:false, git_commit:b554b47e4291231a19680c7bc8c0697658eac025
run shm_open1 in files_createSharedMem
thread '<unnamed>' panicked at 'memory allocation of 151044104 bytes failed
', src/entry.rs:128:5
stack backtrace:
   0: rust_begin_unwind
   1: core::panicking::panic_fmt
             at library/core/src/panicking.rs:142
   2: occlum_libos_core_rs::entry::oom_handle
   3: rust_oom
   4: __rg_oom
             at library/alloc/src/alloc.rs:411
   5: alloc::alloc::handle_alloc_error::rt_error
             at library/alloc/src/alloc.rs:377
   6: core::ops::function::FnOnce::call_once
             at /rustc/68369a041cea809a87e5bd80701da90e0e0a4799/library/core/src/ops/function.rs:227
   7: core::intrinsics::const_eval_select
             at /rustc/68369a041cea809a87e5bd80701da90e0e0a4799/library/core/src/intrinsics.rs:2366
   8: alloc::alloc::handle_alloc_error
             at library/alloc/src/alloc.rs:381
   9: alloc::raw_vec::RawVec<T,A>::reserve::do_reserve_and_handle
  10: <rcore_fs_ramfs::LockedINode as rcore_fs::vfs::INode>::resize
  11: <occlum_libos_core_rs::fs::inode_file::INodeFile as occlum_libos_core_rs::fs::file::File>::set_len
  12: occlum_libos_core_rs::fs::file_ops::truncate::do_ftruncate
  13: occlum_libos_core_rs::syscall::dispatch_syscall
  14: occlum_libos_core_rs::syscall::do_syscall
  15: occlum_syscall
  16: <unknown>
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.
fatal runtime error: failed to initiate panic, error 5
/opt/occlum/build/bin/occlum: line 455:  7300 Illegal instruction     (core dumped) RUST_BACKTRACE=1 "$instance_dir/build/bin/occlum-run" "$@"
```
# 0913
```
occlum run /bin/honggfuzz -P -i in -o out -n 1 -t 5 -- ./kmeans 1000000 ___FILE___
```
# 0912
```
includes:
  - base.yaml
# sysbench
targets:
  # copy sysbench
  - target: /bin
    copy:
      - files:
        - ../honggfuzz
        - ../ls
        - ../cp
  - target: /
    copy:
      - from: ../test
        dirs:
          - in
          - out11
          - work1
        files: 
          - kmeans
          - 1000000
#          - arith.wasm
#      - from: ../
#        files: 
#          - exec.txt
#          - info.txt
  - target: /opt/occlum/glibc/etc
    copy:
      - files:
        - name: /usr/share/zoneinfo/Asia/Shanghai
          rename: localtime
```
```
[2024-09-12T14:38:12Z ERROR copy_bom::bom] ../honggfuzz.yaml is not a valid bom file. targets[1].copy[0].files: data did not m
atch any variant of untagged enum NormalFile at line 19 column 11.
```
# 0911
```
SHM_ID_0 value: 0 in arch_checkWait
thread '<unnamed>' panicked at 'failed to sync when dropping the SEFS Inode: DeviceError(5)', /home/yyw/EnclaveTrace/occlum_1122/deps/sefs/rcore-fs-s
efs/src/lib.rs:805:14
stack backtrace:
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.
fatal runtime error: failed to initiate panic, error 5
/opt/occlum/build/bin/occlum: line 455: 77767 Illegal instruction     (core dumped) RUST_BACKTRACE=1 "$instance_dir/build/bin/occlum-run" "$@"

```
```
bool sig_handled_flag = false; // New flag to track whether the signal has already been handled
// ÂºÇÂ∏∏‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞
void sig_handler(int signo, siginfo_t *info, void *context) {
    // If the signal has already been handled, return immediately
    if (sig_handled_flag) {
        printf("Signal already handled, ignoring subsequent signal.\n");
        crash_flag = true;
        exit(1);
    }
    sig_handled_flag = true; // Set the flag to indicate the signal is being handled
    crash_flag = true;
    handler(info, context);
    char *shm_data;

    pid_t parent_tid = atoi(getenv("PARENT_TID"));
    if (parent_tid == 0) {
        fprintf(stderr, "Error: PARENT_TID environment variable not found.\n");
        return;
    }
    int threads_max = get_thread_max();

    char shm_id_var_name[32];
    snprintf(shm_id_var_name, sizeof(shm_id_var_name), "SHM_ID_%d", parent_tid % threads_max);

    char* shm_id_str = getenv(shm_id_var_name);
    if (shm_id_str == NULL) {
        fprintf(stderr, "Error: %s environment variable not found.\n", shm_id_var_name);
        return;
    }

    int shm_id = atoi(shm_id_str);
    printf("%s value: %d in sig_handler\n", shm_id_var_name, shm_id);

    /*char* shm_id_str = getenv("SHM_ID_STR");
    if (shm_id_str == NULL) {
        fprintf(stderr, "Error: SHM_ID_STR environment variable not found.\n");
        exit(1);
    }

    int shm_id = atoi(shm_id_str);*/
    if ((shm_data = shmat(shm_id, NULL, 0)) == (void *)-1) {
        perror("shmat");
        exit(1);
    }

    uint32_t *futex = (uint32_t *)shm_data;
    char *exec = (char *)((char *)shm_data + EXEC_OFFSET);

    // ÈîÅÂÆöÂÖ±‰∫´ÂÜÖÂ≠ò
    
    if (signo == SIGSEGV) {
        lock(futex);
        strncpy(exec, "segv", 64);
        unlock(futex);
        printf("Child set exec status to 'segv'\n");
    } else if (signo == SIGILL) {
        lock(futex);
        strncpy(exec, "ill", 64);
        unlock(futex);
        printf("Child set exec status to 'ill'\n");
    } else if (signo == SIGFPE) {
        lock(futex);
        strncpy(exec, "fpe", 64);
        unlock(futex);
        printf("Child set exec status to 'fpe'\n");
    } else if (signo == SIGABRT) {
        lock(futex);
        strncpy(exec, "abrt", 64);
        unlock(futex);
        printf("Child set exec status to 'abrt'\n");
    }

    shmdt(shm_data);

    // Á≠âÂæÖÁà∂ËøõÁ®ãËÆæÁΩÆ exec[1] ‰∏∫ "cont"
    while (1) {
        if ((shm_data = shmat(shm_id, NULL, 0)) == (void *)-1) {
            perror("shmat");
            exit(1);
        }

        uint32_t *futex1 = (uint32_t *)shm_data;
        char *exec = (char *)((char *)shm_data + EXEC_OFFSET);

        // ÈîÅÂÆöÂÖ±‰∫´ÂÜÖÂ≠ò
        lock(futex1);
        if (strcmp(exec + 64, "cont") == 0) { // exec[1]
            // ËÆæÁΩÆ exec[2] ‰∏∫ "done"
            printf("Child: 'cont' detected, continuing execution.\n");
            //strncpy(exec + 128, "done", 64);
            //printf("Child set exec status to 'done'\n");
            unlock(futex1); // Ëß£ÈîÅÂÖ±‰∫´ÂÜÖÂ≠ò
            shmdt(shm_data);
            break;
        }
        unlock(futex1); // Ëß£ÈîÅÂÖ±‰∫´ÂÜÖÂ≠ò

        shmdt(shm_data);
        usleep(100);
    }
    sig_handled_flag = false; // Reset the flag after signal handling is done
    exit(1);
}
```
# 0910
```
SHM_ID_0 value: 0 in arch_checkWait
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
run handler 
thread '<unnamed>' panicked at 'the nested signal is too deep to handle', src/signal/do_sigreturn.rs:143:9
stack backtrace:
   0: rust_begin_unwind
   1: core::panicking::panic_fmt
             at library/core/src/panicking.rs:142
   2: occlum_libos_core_rs::signal::do_sigreturn::handle_signal
   3: occlum_libos_core_rs::signal::do_sigreturn::force_signal
   4: occlum_libos_core_rs::exception::do_handle_exception
   5: occlum_libos_core_rs::syscall::do_syscall
   6: occlum_syscall
   7: <unknown>
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.
fatal runtime error: failed to initiate panic, error 5
/opt/occlum/build/bin/occlum: line 455: 33207 Illegal instruction     (core dumped) RUST_BACKTRACE=1 "$instance_dir/build/bin/occlum-run" "$@"
]0;yyw@yyw-virtual-machine: ~/EnclaveTrace/honggfuzz/ins_crypt-1[01;32myyw@yyw-virtual-machine[00m:[01;34m~/EnclaveTrace/honggfuzz/ins_crypt-1[00m$ exit
```
# 0909
```
OCCLUM_LOG_LEVEL=trace
occlum run /bin/honggfuzz -P -i in -o out1 -n 1 -t 5 -- ./Crypt -d -i ___FILE___ -o f
copy_bom -f ../honggfuzz.yaml --root image --include-dir /opt/occlum/etc/template
-d -i ___FILE___ -o f
-e -i ___FILE___ -o f
```
# 0905
```
thread '<unnamed>' panicked at 'explicit panic', src/fs/procfs/stat.rs:35:9
stack backtrace:
   0: rust_begin_unwind
   1: core::panicking::panic_fmt
             at library/core/src/panicking.rs:142
   2: core::panicking::panic
             at library/core/src/panicking.rs:48
   3: occlum_libos_core_rs::fs::procfs::stat::fill_in_stat
   4: <occlum_libos_core_rs::fs::procfs::stat::StatINode as occlum_libos_core_rs::fs::procfs::proc_inode::ProcINode>::generate_data_in_bytes
   5: <occlum_libos_core_rs::fs::procfs::proc_inode::file::File<T> as rcore_fs::vfs::INode>::read_at
   6: <occlum_libos_core_rs::fs::inode_file::INodeFile as occlum_libos_core_rs::fs::file::File>::read
   7: occlum_libos_core_rs::fs::file_ops::read::do_read
   8: occlum_libos_core_rs::fs::syscalls::do_read
   9: occlum_libos_core_rs::syscall::do_syscall
  10: occlum_syscall
  11: <unknown>
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.
fatal runtime error: failed to initiate panic, error 5
/opt/occlum/build/bin/occlum: line 455: 501105 Illegal instruction     (core dumped) RUST_BACKTRACE=1 "$instance_dir/build/bin/occlum-run" "$@
```
```
[W][2] getCpuUse():127 fscanf('/proc/stat') != 4

   2: core::panicking::panic
             at library/core/src/panicking.rs:48
   3: occlum_libos_core_rs::fs::procfs::stat::fill_in_stat
   4: <occlum_libos_core_rs::fs::procfs::stat::StatINode as occlum_libos_core_rs::fs::procfs::proc_inode::ProcINode>::generate_data_in_bytes
   5: <occlum_libos_core_rs::fs::procfs::proc_inode::file::File<T> as rcore_fs::vfs::INode>::read_at
   6: <occlum_libos_core_rs::fs::inode_file::INodeFile as occlum_libos_core_rs::fs::file::File>::read
   7: occlum_libos_core_rs::fs::file_ops::read::do_read
   8: occlum_libos_core_rs::fs::syscalls::do_read
   9: occlum_libos_core_rs::syscall::do_syscall
  10: occlum_syscall
  11: <unknown>
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.
fatal runtime error: failed to initiate panic, error 5
/home/yyw/EnclaveTrace/occlum_1122/build/bin/occlum: line 455: 362580 Illegal instruction     (core dumped) RUST_BACKTRACE=1 "$instance_dir/build/
bin/occlum-run" "$@"
```
# 0903
```
[2024-09-02T10:32:42.673Z][DEBUG][T0][#5317][RtSigsuspend] clean shm: ShmSegment { shmid: 2, key: 0, uid: 0, gid: 0, cuid: 0, cgid: 0, mode: S_IRUSR | S_IWUSR, status: (empty), shm_atime: 1725273162, shm_dtime: 1725273162, shm_ctime: 1725272985, shm_cpid: 2, shm_lpid: 660, shm_nattach: 64, chunk: range = VMRange { start: 0x7f4cda670000, end: 0x7f4cda671000, size: 0x1000 }, Single VMA chunk: SgxMutex { data: VMArea { range: VMRange { start: 0x7f4cda670000, end: 0x7f4cda671000, size: 0x1000 }, perms: READ | WRITE | DEFAULT, file_backed: None, access: Private(2) }, poisoned: false, .. }, process_set: {} }
[2024-09-02T10:32:42.673Z][DEBUG][T0][#5317][RtSigsuspend] drop shm: ShmSegment { shmid: 2, key: 0, uid: 0, gid: 0, cuid: 0, cgid: 0, mode: S_IRUSR | S_IWUSR, status: (empty), shm_atime: 1725273162, shm_dtime: 1725273162, shm_ctime: 1725272985, shm_cpid: 2, shm_lpid: 660, shm_nattach: 64, chunk: range = VMRange { start: 0x7f4cda670000, end: 0x7f4cda671000, size: 0x1000 }, Single VMA chunk: SgxMutex { data: VMArea { range: VMRange { start: 0x7f4cda670000, end: 0x7f4cda671000, size: 0x1000 }, perms: READ | WRITE | DEFAULT, file_backed: None, access: Private(2) }, poisoned: false, .. }, process_set: {} }
thread '<unnamed>' panicked at 'assertion failed: self.shm_nattach == 0', src/ipc/shm.rs:211:9
stack backtrace:
   0: rust_begin_unwind
   1: core::panicking::panic_fmt
             at library/core/src/panicking.rs:142
   2: core::panicking::panic
             at library/core/src/panicking.rs:48
   3: <occlum_libos_core_rs::ipc::shm::ShmSegment as core::ops::drop::Drop>::drop
   4: occlum_libos_core_rs::ipc::shm::ShmManager::clean_when_libos_exit
   5: occlum_libos_core_rs::vm::user_space_vm::free_user_space
   6: uninit_global_object
   7: do_uninit_enclave
   8: enter_enclave
   9: <unknown>
  10: <unknown>
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.
fatal runtime error: failed to initiate panic, error 5
/opt/occlum/build/bin/occlum: line 455: 268826 Illegal instruction     (core dumped) RUST_BACKTRACE=1 "$instance_dir/build/bin/occlum-run" "$@"

```
# 0902
```
RUST_BACKTRACE=full
```
```
thread '<unnamed>' panicked at 'assertion failed: self.shm_nattach == 0', src/ipc/shm.rs:211:9
stack backtrace:
   0: rust_begin_unwind
   1: core::panicking::panic_fmt
             at library/core/src/panicking.rs:142
   2: core::panicking::panic
             at library/core/src/panicking.rs:48
   3: <occlum_libos_core_rs::ipc::shm::ShmSegment as core::ops::drop::Drop>::drop
   4: occlum_libos_core_rs::ipc::shm::ShmManager::clean_when_libos_exit
   5: occlum_libos_core_rs::vm::user_space_vm::free_user_space
   6: uninit_global_object
   7: do_uninit_enclave
   8: enter_enclave
   9: <unknown>
  10: <unknown>
note: Some details are omitted, call backtrace::enable_backtrace() with 'PrintFormat::Full' for a verbose backtrace.


docker pull reme3180/golang-packr2:latest
docker pull python:3-alpine
docker pull ebpf_exporter:latest

sudo apt install bsdutils
OCCLUM_LOG_LEVEL=trace
```
```
$ ./start.sh 
SGX driver installed!
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  6.848MB
Step 1/19 : FROM reme3180/golang-packr2:latest as builder
latest: Pulling from reme3180/golang-packr2
22dbe790f715: Retrying in 1 second 
0250231711a0: Retrying in 1 second 
6fba9447437b: Retrying in 1 second 
c2b4d327b352: Waiting 
619f4932b7ea: Waiting 
16e105463ffe: Waiting 
ed842bbe1793: Waiting 
d23e7986e00e: Waiting 
error pulling image configuration: download failed after attempts=6: dial tcp 103.230.123.190:443: i/o timeout
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  9.216kB
Step 1/5 : FROM python:3-alpine
3-alpine: Pulling from library/python
c6a83fedfae6: Retrying in 1 second 
6f14051a7863: Retrying in 1 second 
e1e82c77ac9c: Retrying in 1 second 
334024c37334: Waiting 
2240f6c2d99c: Waiting 
^C

```
‰ªé‰Ω†ÁöÑÈîôËØØ‰ø°ÊÅØÊù•ÁúãÔºåÁõÆÂâçÊúâ‰∏§‰∏™‰∏ªË¶ÅÈóÆÈ¢òÔºö

1. **Docker ‰ªìÂ∫ìÁöÑ GPG ÂØÜÈí•‰∏çÂèØÁî®**ÔºöËøôÂØºËá¥Êó†Ê≥ïÈ™åËØÅ Docker ‰ªìÂ∫ìÁöÑÁ≠æÂêç„ÄÇ
2. **`archive.ubuntu.com` ÁöÑ `focal-updates` ‰ªìÂ∫ìËøîÂõû‰∫Ü‰∏Ä‰∏™ 502 Bad Gateway ÈîôËØØ**ÔºöËøôÈÄöÂ∏∏‰∏éÁΩëÁªúÈÖçÁΩÆÊàñ‰ª£ÁêÜËÆæÁΩÆÊúâÂÖ≥„ÄÇ

### 1. Ëß£ÂÜ≥ Docker ‰ªìÂ∫ìÁöÑ GPG ÂØÜÈí•ÈóÆÈ¢ò

Ë¶ÅËß£ÂÜ≥ Docker ‰ªìÂ∫ìÁöÑ GPG ÂØÜÈí•ÈóÆÈ¢òÔºå‰Ω†ÈúÄË¶ÅÊâãÂä®Ê∑ªÂä† Docker ÁöÑ GPG ÂÖ¨Èí•„ÄÇËØ∑ÊåâÁÖß‰ª•‰∏ãÊ≠•È™§Êìç‰ΩúÔºö

```bash
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 7EA0A9C3F273FCD8
```

ÊàñËÄÖÔºå‰Ω†‰πüÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÂëΩ‰ª§Êù•Ëé∑ÂèñÂπ∂Ê∑ªÂä† GPG ÂÖ¨Èí•Ôºö

```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
```

Ê∑ªÂä† GPG ÂØÜÈí•ÂêéÔºåÂÜçÊ¨°ËøêË°å `sudo apt update` Êù•Êõ¥Êñ∞ÂåÖÂàóË°®„ÄÇ

### 2. Ëß£ÂÜ≥ `archive.ubuntu.com` ÁöÑ `502 Bad Gateway` ÈîôËØØ

502 ÈîôËØØÈÄöÂ∏∏‰∏é‰ª£ÁêÜËÆæÁΩÆÊúâÂÖ≥„ÄÇÂú®‰Ω†ÁöÑËæìÂá∫‰∏≠ÔºåÈîôËØØ‰ø°ÊÅØÊòæÁ§∫‰ªé `http://archive.ubuntu.com` Ëé∑ÂèñÊï∞ÊçÆÊó∂ËøîÂõû‰∫Ü `502 Bad Gateway`ÔºåÂπ∂‰∏î IP Âú∞ÂùÄÊòØ `127.0.0.1:7890`„ÄÇËøôË°®Êòé `apt` Âú®Â∞ùËØïÈÄöËøáÊú¨Âú∞‰ª£ÁêÜËøûÊé•Âà∞Â§ñÈÉ®ÊúçÂä°Âô®Ôºå‰ΩÜ‰ª£ÁêÜÊ≤°ÊúâÊ≠£Á°ÆÂ∑•‰Ωú„ÄÇ

#### Ê£ÄÊü•ÂíåÊõ¥Êñ∞‰ª£ÁêÜËÆæÁΩÆ

ËØ∑Ê£ÄÊü•‰Ω†ÁöÑ‰ª£ÁêÜËÆæÁΩÆÊòØÂê¶Ê≠£Á°Æ„ÄÇ‰Ω†ÂèØ‰ª•Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáèÂíå `apt` ÁöÑ‰ª£ÁêÜÈÖçÁΩÆ„ÄÇ

1. **Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáè**Ôºö

   Âú®ÁªàÁ´Ø‰∏≠ÔºåÊ£ÄÊü• HTTP Âíå HTTPS ‰ª£ÁêÜËÆæÁΩÆÔºö

   ```bash
   echo $http_proxy
   echo $https_proxy
   ```

   Â¶ÇÊûúÊòæÁ§∫ÁöÑÊòØ `http://127.0.0.1:7890`ÔºåËØ¥Êòé `apt` Ê≠£Âú®‰ΩøÁî®Êú¨Âú∞‰ª£ÁêÜ„ÄÇÁ°Æ‰øù‰Ω†ÁöÑ‰ª£ÁêÜÊúçÂä°Âú®Êú¨Âú∞Ê≠£Â∏∏ËøêË°å„ÄÇ

2. **Êõ¥Êñ∞‰ª£ÁêÜËÆæÁΩÆ**Ôºö

   Â¶ÇÊûú‰Ω†‰∏çÊâìÁÆó‰ΩøÁî®‰ª£ÁêÜÔºåÂèØ‰ª•Ê∏ÖÈô§‰ª£ÁêÜËÆæÁΩÆÔºö

   ```bash
   unset http_proxy
   unset https_proxy
   sudo sed -i '/Acquire::http::Proxy/d' /etc/apt/apt.conf.d/proxy.conf
   sudo sed -i '/Acquire::https::Proxy/d' /etc/apt/apt.conf.d/proxy.conf
   ```

   Â¶ÇÊûúÈúÄË¶Å‰ΩøÁî®‰ª£ÁêÜÔºåËØ∑Á°Æ‰øù‰ª£ÁêÜÊúçÂä°Âô®Âú∞ÂùÄÊ≠£Á°Æ‰∏îÂèØËÆøÈóÆ„ÄÇ

#### ÈáçÊñ∞ÂêØÂä®ÁΩëÁªúÊúçÂä°

Âú®Êõ¥Êîπ‰ª£ÁêÜËÆæÁΩÆÂêéÔºåÈáçÊñ∞ÂêØÂä®ÁΩëÁªúÊúçÂä°‰ª•Á°Æ‰øùÈÖçÁΩÆÁîüÊïàÔºö

```bash
sudo systemctl restart networking
```

### ÊÄªÁªì

1. Ê∑ªÂä† Docker ‰ªìÂ∫ìÁöÑ GPG ÂÖ¨Èí•‰ª•Ëß£ÂÜ≥ GPG ÈîôËØØ„ÄÇ
2. Ê£ÄÊü•Âπ∂Êõ¥Êñ∞‰ª£ÁêÜËÆæÁΩÆ‰ª•Ëß£ÂÜ≥ `502 Bad Gateway` ÈîôËØØ„ÄÇ
3. ÈáçÊñ∞ÂêØÂä®ÁΩëÁªúÊúçÂä°‰ª•Á°Æ‰øùÊõ¥ÊîπÁîüÊïà„ÄÇ

ÂÆåÊàêËøô‰∫õÊ≠•È™§ÂêéÔºåËØ∑ÂÜçÊ¨°ËøêË°å `sudo apt update`ÔºåËøôÂ∫îËØ•‰ºöËß£ÂÜ≥‰Ω†ÁöÑÈóÆÈ¢ò„ÄÇ
```
$ sudo apt update
Hit:1 http://mirrors.bwbot.org stable InRelease
Hit:2 https://dl.google.com/linux/chrome/deb stable InRelease                                                                           
Get:3 https://download.docker.com/linux/ubuntu focal InRelease [57.7 kB]                                                                
Err:3 https://download.docker.com/linux/ubuntu focal InRelease                                                                          
  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY 7EA0A9C3F273FCD8
Hit:4 https://download.01.org/intel-sgx/sgx_repo/ubuntu focal InRelease                   
Hit:6 http://archive.ubuntu.com/ubuntu focal InRelease                                           
Hit:7 http://security.ubuntu.com/ubuntu focal-security InRelease                                 
Hit:5 https://apt.llvm.org/focal llvm-toolchain-focal-13 InRelease                               
Err:8 http://archive.ubuntu.com/ubuntu focal-updates InRelease
  502  Bad Gateway [IP: 127.0.0.1 7890]
Hit:9 http://archive.ubuntu.com/ubuntu focal-backports InRelease
Reading package lists... Done
W: GPG error: https://download.docker.com/linux/ubuntu focal InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY 7EA0A9C3F273FCD8
E: The repository 'https://download.docker.com/linux/ubuntu focal InRelease' is not signed.
N: Updating from such a repository can't be done securely, and is therefore disabled by default.
N: See apt-secure(8) manpage for repository creation and user configuration details.
E: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/focal-updates/InRelease  502  Bad Gateway [IP: 127.0.0.1 7890]
E: The repository 'http://archive.ubuntu.com/ubuntu focal-updates InRelease' is no longer signed.
N: Updating from such a repository can't be done securely, and is therefore disabled by default.
N: See apt-secure(8) manpage for repository creation and user configuration details.

```
‰ªé‰Ω†ÁöÑÊèèËø∞Êù•ÁúãÔºå‰Ω†ÂèØ‰ª•Âú®ÊµèËßàÂô®‰∏≠ËÆøÈóÆÁΩëÈ°µÂπ∂‰∏îÂ∑≤ÁªèÊ∑ªÂä†‰∫Ü‰ª£ÁêÜÔºå‰ΩÜ‰ªçÁÑ∂Êó†Ê≥ïÈÄöËøá `apt` ËÆøÈóÆ Docker ÁöÑ‰∏ãËΩΩÊúçÂä°Âô®„ÄÇËøôÂèØËÉΩÊòØÂõ†‰∏∫ `apt` Ê≤°ÊúâÊ≠£Á°ÆÂú∞‰ΩøÁî®‰Ω†ÁöÑ‰ª£ÁêÜËÆæÁΩÆ„ÄÇ‰ª•‰∏ãÊòØ‰∏Ä‰∫õËß£ÂÜ≥ÊñπÊ≥ïÔºö

### 1. ‰∏∫ `apt` ÈÖçÁΩÆ‰ª£ÁêÜ

‰Ω†ÈúÄË¶ÅÁ°Æ‰øù `apt` Ê≠£Á°Æ‰ΩøÁî®‰∫Ü‰ª£ÁêÜ„ÄÇ‰Ω†ÂèØ‰ª•ÈÄöËøáÂú® APT ÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê∑ªÂä†‰ª£ÁêÜËÆæÁΩÆÊù•ÂÆûÁé∞Ëøô‰∏ÄÁÇπ„ÄÇ

#### ÈÖçÁΩÆ HTTP Âíå HTTPS ‰ª£ÁêÜ

ÁºñËæë `/etc/apt/apt.conf.d/proxy.conf` Êñá‰ª∂ÔºàÂ¶ÇÊûúÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåÂèØ‰ª•ÂàõÂª∫ÔºâÔºö

```bash
sudo nano /etc/apt/apt.conf.d/proxy.conf
```

Âú®Êñá‰ª∂‰∏≠Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºåÊ†πÊçÆ‰Ω†ÁöÑ‰ª£ÁêÜÂú∞ÂùÄÊõøÊç¢ `http://your.proxy.server:port`Ôºö

```plaintext
Acquire::http::Proxy "http://your.proxy.server:port";
Acquire::https::Proxy "http://your.proxy.server:port";
```

‰øùÂ≠òÊñá‰ª∂Âπ∂ÈÄÄÂá∫ÁºñËæëÂô®ÔºåÁÑ∂ÂêéÂÜçËøêË°å `sudo apt update` ‰ª•Êü•ÁúãÈóÆÈ¢òÊòØÂê¶Ëß£ÂÜ≥„ÄÇ

### 2. ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè

‰Ω†ÂèØ‰ª•ÈÄöËøáËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèÊù•Á°Æ‰øùÊâÄÊúâÁªàÁ´ØÂ∫îÁî®ÔºàÂåÖÊã¨ `apt`ÔºâÈÉΩ‰ΩøÁî®‰ª£ÁêÜ„ÄÇ

Âú®ÁªàÁ´Ø‰∏≠ÔºåËÆæÁΩÆ‰ª•‰∏ãÁéØÂ¢ÉÂèòÈáèÔºö

```bash
export http_proxy="http://your.proxy.server:port"
export https_proxy="http://your.proxy.server:port"
```

Ë¶Å‰ΩøËøô‰∫õËÆæÁΩÆÂú®Á≥ªÁªüÈáçÂêØÂêé‰ªçÁÑ∂ÁîüÊïàÔºå‰Ω†ÂèØ‰ª•Â∞ÜÂÆÉ‰ª¨Ê∑ªÂä†Âà∞ `~/.bashrc` Êàñ `~/.bash_profile` Êñá‰ª∂‰∏≠Ôºö

```bash
echo 'export http_proxy="http://your.proxy.server:port"' >> ~/.bashrc
echo 'export https_proxy="http://your.proxy.server:port"' >> ~/.bashrc
source ~/.bashrc
```

### 3. Á°Æ‰øù‰ª£ÁêÜÊîØÊåÅ HTTPS

‰∏Ä‰∫õ‰ª£ÁêÜÊúçÂä°Âô®ÂèØËÉΩÂè™ÊîØÊåÅ HTTP ÊµÅÈáèÔºåËÄå Docker ÁöÑ‰ªìÂ∫ìÊòØÈÄöËøá HTTPS Êèê‰æõÁöÑ„ÄÇËØ∑Á°Æ‰øù‰Ω†ÁöÑ‰ª£ÁêÜÊúçÂä°Âô®ÊîØÊåÅ HTTPSÔºåÂπ∂‰∏îÂèØ‰ª•ÈÄöËøáÁ´ØÂè£ 443 Ê≠£Â∏∏Â∑•‰Ωú„ÄÇ

### 4. ‰ΩøÁî® `curl` ÊµãËØï‰ª£ÁêÜËÆæÁΩÆ

‰Ω†ÂèØ‰ª•‰ΩøÁî® `curl` ÂëΩ‰ª§Êù•ÊµãËØï‰ª£ÁêÜÊòØÂê¶Ê≠£Á°ÆÈÖçÁΩÆÔºåÂπ∂‰∏îËÉΩÂ§üËÆøÈóÆ Docker ÁöÑÊúçÂä°Âô®Ôºö

```bash
curl -v -x http://your.proxy.server:port https://download.docker.com/linux/ubuntu/dists/focal/InRelease
```

Â¶ÇÊûú‰Ω†ËÉΩÂ§üÈÄöËøá `curl` ÊàêÂäüËøûÊé•Âà∞ Docker ÁöÑÊúçÂä°Âô®ÔºåÈÇ£‰πàÈóÆÈ¢òÂèØËÉΩÂá∫Âú® `apt` ÁöÑÈÖçÁΩÆ‰∏ä„ÄÇ

### 5. Ê£ÄÊü•ÁΩëÁªúÈÖçÁΩÆÂíåÈò≤ÁÅ´Â¢ô

Á°Æ‰øù‰Ω†ÁöÑÁΩëÁªúÈÖçÁΩÆÂíåÈò≤ÁÅ´Â¢ôËÆæÁΩÆÊ≤°ÊúâÈòªÊ≠¢ `apt` ËÆøÈóÆÂ§ñÈÉ®ÁΩëÁªú„ÄÇ‰Ω†ÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Ê£ÄÊü•ÂΩìÂâçÁöÑÈò≤ÁÅ´Â¢ôÁä∂ÊÄÅÔºö

```bash
sudo ufw status
```

Â¶ÇÊûúÂèëÁé∞ÊúâËßÑÂàôÈòªÊ≠¢Â§ñÈÉ®ËÆøÈóÆÔºåÂèØËÉΩÈúÄË¶Å‰øÆÊîπÈò≤ÁÅ´Â¢ôÈÖçÁΩÆ„ÄÇ

### 6. ÈáçÂêØÁΩëÁªúÊúçÂä°

ÊúâÊó∂ÂÄôÔºåÁÆÄÂçïÂú∞ÈáçÂêØÁΩëÁªúÊúçÂä°ÂèØËÉΩ‰ºöËß£ÂÜ≥ÈóÆÈ¢òÔºö

```bash
sudo systemctl restart networking
```

### 7. Êõ¥Êñ∞ Docker APT Ê∫êÈÖçÁΩÆ

Â¶ÇÊûúÊâÄÊúâÊñπÊ≥ïÂùáÊó†ÊïàÔºåÂ∞ùËØïÊõ¥Êñ∞ Docker ÁöÑ APT Ê∫êÈÖçÁΩÆÊñá‰ª∂Ôºö

```bash
sudo nano /etc/apt/sources.list.d/docker.list
```

Á°Æ‰øùÊñá‰ª∂ÂÜÖÂÆπÊ≠£Á°ÆÊó†ËØØÔºå‰æãÂ¶ÇÔºö

```plaintext
deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
```

‰øùÂ≠òÊñá‰ª∂Âπ∂ÈÄÄÂá∫ÁºñËæëÂô®ÔºåÁÑ∂ÂêéÂÜçÊ¨°ËøêË°åÔºö

```bash
sudo apt update
```

ÈÄöËøáËøô‰∫õÊ≠•È™§Ôºå‰Ω†Â∫îËØ•ËÉΩÂ§üËß£ÂÜ≥ÈÄöËøá‰ª£ÁêÜËÆøÈóÆ Docker ÊúçÂä°Âô®ÁöÑÈóÆÈ¢ò„ÄÇÂ¶ÇÊûúÈóÆÈ¢ò‰ªçÁÑ∂Â≠òÂú®ÔºåËØ∑Ê£ÄÊü•‰ª£ÁêÜÊúçÂä°Âô®ÂíåÁΩëÁªúÈÖçÁΩÆÁöÑÂÖ∂‰ªñÁªÜËäÇ„ÄÇ
```
63 packages can be upgraded. Run 'apt list --upgradable' to see them.
W: Failed to fetch https://download.docker.com/linux/ubuntu/dists/focal/InRelease  Cannot initiate the connection to download.docker.com:443 (2a03:2880:f111:83:face:b00c:0:25de). - connect (101: Network is unreachable) Could not connect to download.docker.com:443 (31.13.82.33), connection timed out
W: Some index files failed to download. They have been ignored, or old ones used instead.

```

https://cdn.v2free.top/user

```
Err:12 https://download.docker.com/linux/ubuntu focal InRelease                                                   
  Cannot initiate the connection to download.docker.com:443 (2001::6ca0:a63d). - connect (101: Network is unreachable) Could not connect to download.docker.com:443 (103.230.123.190), connection timed out
Fetched 6,119 kB in 30s (202 kB/s)                      
Reading package lists... Done
Building dependency tree       
Reading state information... Done
63 packages can be upgraded. Run 'apt list --upgradable' to see them.
W: Failed to fetch https://download.docker.com/linux/ubuntu/dists/focal/InRelease  Cannot initiate the connection to download.docker.com:443 (2001::6ca0:a63d). - connect (101: Network is unreachable) Could not connect to download.docker.com:443 (103.230.123.190), connection timed out
W: Some index files failed to download. They have been ignored, or old ones used instead.
W: Target Packages (stable/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target Packages (stable/binary-all/Packages) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target Translations (stable/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target Translations (stable/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target DEP-11 (stable/dep11/Components-amd64.yml) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target DEP-11 (stable/dep11/Components-all.yml) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target DEP-11-icons-small (stable/dep11/icons-48x48.tar) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target DEP-11-icons (stable/dep11/icons-64x64.tar) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target DEP-11-icons-hidpi (stable/dep11/icons-64x64@2.tar) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target CNF (stable/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1
W: Target CNF (stable/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list:63 and /etc/apt/sources.list.d/docker.list:1


Ê†πÊçÆ‰Ω†Êèê‰æõÁöÑÈîôËØØ‰ø°ÊÅØÔºå‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂá†‰∏™ÈóÆÈ¢òÔºö

ÁΩëÁªúËøûÊé•ÈóÆÈ¢ò: Êó†Ê≥ïËøûÊé•Âà∞ download.docker.comÔºåÂØºËá¥Êó†Ê≥ï‰∏ãËΩΩ Docker ÁöÑËΩØ‰ª∂ÂåÖ„ÄÇ
ÈáçÂ§çÁöÑ Docker Ê∫ê: Docker ÁöÑÊ∫êÂú® /etc/apt/sources.list Âíå /etc/apt/sources.list.d/docker.list Êñá‰ª∂‰∏≠Ë¢´ÈÖçÁΩÆ‰∫ÜÂ§öÊ¨°„ÄÇ
1. Ëß£ÂÜ≥ÁΩëÁªúËøûÊé•ÈóÆÈ¢ò
È¶ñÂÖàÔºåÁ°Æ‰øù‰Ω†ÁöÑÁ≥ªÁªüÂèØ‰ª•ËÆøÈóÆ‰∫íËÅîÁΩëÂπ∂‰∏î DNS ÈÖçÁΩÆÊ≠£Á°Æ„ÄÇ‰Ω†ÂèØ‰ª•Â∞ùËØï‰ª•‰∏ãÂá†Ê≠•Êù•Ëß£ÂÜ≥ÁΩëÁªúËøûÊé•ÈóÆÈ¢òÔºö

Ê£ÄÊü•‰∫íËÅîÁΩëËøûÊé•
Á°Æ‰øù‰Ω†ÁöÑÁ≥ªÁªüËøûÊé•Âà∞‰∫íËÅîÁΩë„ÄÇ‰Ω†ÂèØ‰ª•Â∞ùËØï‰ª•‰∏ãÂëΩ‰ª§Êù•ÊµãËØïÔºö

bash
Copy code
ping -c 4 google.com
Â¶ÇÊûúÊó†Ê≥ï ping ÈÄöÔºåÂèØËÉΩÈúÄË¶ÅÊ£ÄÊü•ÁΩëÁªúËøûÊé•„ÄÇ

Ê£ÄÊü•Èò≤ÁÅ´Â¢ôÂíå‰ª£ÁêÜËÆæÁΩÆ
Â¶ÇÊûú‰Ω†ÁöÑÁΩëÁªúÁéØÂ¢ÉÊúâÈò≤ÁÅ´Â¢ôÊàñËÄÖ‰ª£ÁêÜÔºåÁ°Æ‰øùÂÆÉ‰ª¨Ê≤°ÊúâÈòªÊ≠¢ÂØπ download.docker.com ÁöÑËÆøÈóÆ„ÄÇ

‰ΩøÁî® IPv4 ËøõË°åËøûÊé•
Â¶ÇÊûú‰Ω†Âú® IPv6 ÁΩëÁªú‰∏≠ÊúâÈóÆÈ¢òÔºåÂèØ‰ª•Â∞ùËØïÁ¶ÅÁî® IPv6 ÊàñÂº∫Âà∂‰ΩøÁî® IPv4„ÄÇÁºñËæëÊàñÂàõÂª∫Êñá‰ª∂ /etc/apt/apt.conf.d/99force-ipv4ÔºåÂπ∂Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

bash
Copy code
Acquire::ForceIPv4 "true";
‰øùÂ≠òÊñá‰ª∂ÂêéÔºåÂÜçÊ¨°ËøêË°å sudo apt update Êù•Êü•ÁúãÊòØÂê¶Ëß£ÂÜ≥‰∫ÜÈóÆÈ¢ò„ÄÇ

2. Ëß£ÂÜ≥ÈáçÂ§çÁöÑ Docker Ê∫êÈÖçÁΩÆ
Docker Ê∫êÂú®‰∏§‰∏™‰∏çÂêåÁöÑÂú∞ÊñπË¢´ÈÖçÁΩÆ‰∫ÜÔºåËøôÂèØËÉΩ‰ºöÂØºËá¥ÂÜ≤Á™Å„ÄÇ‰Ω†ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÊ≠•È™§Êù•Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºö

ÁºñËæë /etc/apt/sources.list Êñá‰ª∂
‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§ÊâìÂºÄ /etc/apt/sources.list Êñá‰ª∂Ôºö

bash
Copy code
sudo nano /etc/apt/sources.list
Êü•ÊâæÊâÄÊúâÊúâÂÖ≥ Docker ÁöÑÊù°ÁõÆÔºàÁ±ª‰ºº‰∫é deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stableÔºâÔºåÂπ∂Â∞ÜÂÖ∂Ê≥®ÈáäÊéâÔºàÂú®Ë°åÂâçÂä†‰∏ä #Ôºâ„ÄÇ

ÁºñËæë /etc/apt/sources.list.d/docker.list Êñá‰ª∂
ÂêåÊ†∑ÁöÑÔºå‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§ÊâìÂºÄ /etc/apt/sources.list.d/docker.list Êñá‰ª∂Ôºö

bash
Copy code
sudo nano /etc/apt/sources.list.d/docker.list
Á°Æ‰øùÊñá‰ª∂‰∏≠Âè™Êúâ‰∏Ä‰∏™ Docker Ê∫êÊù°ÁõÆÔºåÁ±ª‰ºº‰∫éÔºö

plaintext
Copy code
deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
‰øùÂ≠òÂπ∂ÈÄÄÂá∫ÁºñËæëÂô®„ÄÇ

Êõ¥Êñ∞ÂåÖÂàóË°®
ÁºñËæëÂÆåÊàêÂêéÔºåËøêË°å‰ª•‰∏ãÂëΩ‰ª§Êõ¥Êñ∞ÂåÖÂàóË°®Ôºö

bash
Copy code
sudo apt update
3. ÊÄªÁªì
ÈÄöËøá‰∏äËø∞Ê≠•È™§Ôºå‰Ω†Â∫îËØ•ÂèØ‰ª•Ëß£ÂÜ≥ Docker Ê∫êÈáçÂ§çÈÖçÁΩÆÂíåÁΩëÁªúËøûÊé•ÈóÆÈ¢ò„ÄÇÂ¶ÇÊûú‰æùÁÑ∂Â≠òÂú®ÁΩëÁªúËøûÊé•ÈóÆÈ¢òÔºåÂª∫ËÆÆËøõ‰∏ÄÊ≠•Ê£ÄÊü•ÁΩëÁªúÈÖçÁΩÆÂíå‰ª£ÁêÜËÆæÁΩÆ„ÄÇ

Err:8 https://download.docker.com/linux/ubuntu focal InRelease                                   
  Cannot initiate the connection to download.docker.com:443 (2a03:2880:f131:83:face:b00c:0:25de). - connect (101: Network is unreachable) Could not connect to download.docker.com:443 (104.244.43.208), connection timed out
Reading package lists... Done                                              
Building dependency tree       
Reading state information... Done
63 packages can be upgraded. Run 'apt list --upgradable' to see them.
W: Failed to fetch https://download.docker.com/linux/ubuntu/dists/focal/InRelease  Cannot initiate the connection to download.docker.com:443 (2a03:2880:f131:83:face:b00c:0:25de). - connect (101: Network is unreachable) Could not connect to download.docker.com:443 (104.244.43.208), connection timed out
W: Some index files failed to download. They have been ignored, or old ones used instead.

Ê†πÊçÆ‰Ω†Êèê‰æõÁöÑÈîôËØØ‰ø°ÊÅØÔºå‰∏ªË¶ÅÈóÆÈ¢ò‰ªçÁÑ∂ÊòØÊó†Ê≥ïËøûÊé•Âà∞ Docker ÁöÑ‰∏ãËΩΩÊúçÂä°Âô®„ÄÇËøôÈÄöÂ∏∏ÊòØÁî±‰∫éÁΩëÁªúËøûÊé•ÈóÆÈ¢òÔºåÂ∞§ÂÖ∂ÊòØ IPv6 ÁΩëÁªú‰∏çÂèØÁî®Êàñ‰ª£ÁêÜËÆæÁΩÆÈóÆÈ¢ò„ÄÇ‰ª•‰∏ãÊòØ‰∏Ä‰∫õËß£ÂÜ≥Ê≠§ÈóÆÈ¢òÁöÑÊ≠•È™§Ôºö

### 1. Âº∫Âà∂‰ΩøÁî® IPv4 ËøûÊé•

Âú®‰∏Ä‰∫õÁΩëÁªúÁéØÂ¢É‰∏≠ÔºåIPv6 ÂèØËÉΩÊó†Ê≥ïÊ≠£Â∏∏Â∑•‰ΩúÔºå‰Ω†ÂèØ‰ª•Â∞ùËØïÂº∫Âà∂ `apt` ‰ΩøÁî® IPv4 ËøûÊé•„ÄÇ 

#### ÁºñËæë APT ÈÖçÁΩÆÊñá‰ª∂

ÂàõÂª∫ÊàñÁºñËæë `/etc/apt/apt.conf.d/99force-ipv4` Êñá‰ª∂ÔºåÂπ∂Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```bash
sudo nano /etc/apt/apt.conf.d/99force-ipv4
```

Âú®Êñá‰ª∂‰∏≠Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```bash
Acquire::ForceIPv4 "true";
```

‰øùÂ≠òÊñá‰ª∂Âπ∂ÈÄÄÂá∫ÁºñËæëÂô®„ÄÇÁÑ∂ÂêéÂÜçËøêË°å `sudo apt update` Êù•Êü•ÁúãÈóÆÈ¢òÊòØÂê¶Ëß£ÂÜ≥„ÄÇ

### 2. Ê£ÄÊü•ÁΩëÁªúËøûÊé•

Á°Æ‰øù‰Ω†ÁöÑÁΩëÁªúËøûÊé•Ê≠£Â∏∏ÔºåÂπ∂‰∏îÊ≤°Êúâ‰ª£ÁêÜÊàñÈò≤ÁÅ´Â¢ôÈòªÊ≠¢ÂØπÂ§ñËøûÊé•„ÄÇ

#### Ê£ÄÊü•‰∫íËÅîÁΩëËøûÊé•

‰ΩøÁî® `ping` ÊµãËØïÁΩëÁªúËøûÊé•Ôºö

```bash
ping -c 4 google.com
```

Â¶ÇÊûú `ping` Â§±Ë¥•ÔºåÊ£ÄÊü•‰Ω†ÁöÑÁΩëÁªúËÆæÁΩÆÔºåÁ°Æ‰øùÁ≥ªÁªüËøûÊé•Âà∞‰∫íËÅîÁΩë„ÄÇ

#### Ê£ÄÊü• DNS ËÆæÁΩÆ

Á°Æ‰øù DNS ËÆæÁΩÆÊ≠£Á°ÆÔºåÂèØ‰ª•‰ΩøÁî® `nslookup` Êàñ `dig` ÂëΩ‰ª§Êù•ÊµãËØïÂüüÂêçËß£ÊûêÔºö

```bash
nslookup download.docker.com
```

Â¶ÇÊûúÂüüÂêçËß£ÊûêÂ§±Ë¥•ÔºåÊ£ÄÊü•‰Ω†ÁöÑ DNS ÈÖçÁΩÆ„ÄÇ

### 3. ‰∏¥Êó∂Á¶ÅÁî® IPv6

Â¶ÇÊûú‰Ω†ËÆ§‰∏∫ IPv6 ÊòØÈóÆÈ¢òÊâÄÂú®ÔºåÂèØ‰ª•Â∞ùËØï‰∏¥Êó∂Á¶ÅÁî® IPv6„ÄÇ

ÁºñËæë `/etc/sysctl.conf` Êñá‰ª∂Ôºö

```bash
sudo nano /etc/sysctl.conf
```

Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÁ¶ÅÁî® IPv6Ôºö

```bash
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
```

‰øùÂ≠òÂπ∂ÈÄÄÂá∫ÁºñËæëÂô®ÔºåÁÑ∂ÂêéËøêË°å‰ª•‰∏ãÂëΩ‰ª§‰ΩøÊõ¥ÊîπÁîüÊïàÔºö

```bash
sudo sysctl -p
```

ÂÜçÊ¨°ËøêË°å `sudo apt update` Ê£ÄÊü•ÊòØÂê¶Ëß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ

### 4. Ê£ÄÊü•‰ª£ÁêÜËÆæÁΩÆ

Â¶ÇÊûú‰Ω†ÁöÑÁΩëÁªúÁéØÂ¢É‰∏≠‰ΩøÁî®‰∫Ü‰ª£ÁêÜÔºåÁ°Æ‰øù‰ª£ÁêÜËÆæÁΩÆÊ≠£Á°ÆÔºåÂπ∂‰∏îÊ≤°ÊúâÈòªÊ≠¢ÂØπ `download.docker.com` ÁöÑËÆøÈóÆ„ÄÇ

#### Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáè

Êü•ÁúãÊòØÂê¶ËÆæÁΩÆ‰∫Ü `http_proxy` Êàñ `https_proxy` ÁéØÂ¢ÉÂèòÈáèÔºö

```bash
echo $http_proxy
echo $https_proxy
```

Â¶ÇÊûúËÆæÁΩÆ‰∫Ü‰ª£ÁêÜÔºåÁ°Æ‰øù‰ª£ÁêÜÊúçÂä°Âô®ËÉΩÂ§üËÆøÈóÆ `download.docker.com`„ÄÇ

### 5. ‰ΩøÁî®Â§áÁî®ÈïúÂÉèÊ∫ê

Â¶ÇÊûú‰Ω†Êó†Ê≥ïËß£ÂÜ≥ËøûÊé•ÈóÆÈ¢òÔºåÂèØ‰ª•Â∞ùËØï‰ΩøÁî®ÂõΩÂÜÖÁöÑ Docker ÈïúÂÉèÊ∫êÔºàÂ¶ÇÊûú‰Ω†Âú®‰∏≠ÂõΩÔºâ„ÄÇ‰æãÂ¶ÇÔºåÈòøÈáå‰∫ëÊèê‰æõ‰∫Ü Docker ÁöÑÈïúÂÉèÊ∫êÔºå‰Ω†ÂèØ‰ª•Â∞Ü Docker ÁöÑÊ∫êÊõøÊç¢‰∏∫ÈòøÈáå‰∫ëÁöÑ„ÄÇ

ÁºñËæë `/etc/apt/sources.list.d/docker.list` Êñá‰ª∂Ôºö

```bash
sudo nano /etc/apt/sources.list.d/docker.list
```

Â∞ÜÂÖ∂‰∏≠ÁöÑ `https://download.docker.com/linux/ubuntu` ÊõøÊç¢‰∏∫ `https://mirrors.aliyun.com/docker-ce/linux/ubuntu`Ôºå‰øùÂ≠òÂπ∂ÈÄÄÂá∫„ÄÇ

ÁÑ∂ÂêéÊõ¥Êñ∞ËΩØ‰ª∂ÂåÖÂàóË°®Ôºö

```bash
sudo apt update
```

ÈÄöËøá‰∏äËø∞Ê≠•È™§Ôºå‰Ω†Â∫îËØ•ËÉΩÂ§üËß£ÂÜ≥Êó†Ê≥ïËøûÊé•Âà∞ Docker ‰∏ãËΩΩÊúçÂä°Âô®ÁöÑÈóÆÈ¢ò„ÄÇÂ¶ÇÊûúÈóÆÈ¢ò‰æùÊóßÂ≠òÂú®ÔºåÂèØËÉΩÈúÄË¶ÅËøõ‰∏ÄÊ≠•Ê£ÄÊü•ÁΩëÁªúÈÖçÁΩÆÊàñËÅîÁ≥ªÁΩëÁªúÁÆ°ÁêÜÂëò„ÄÇ
```
